diff --git a/node_modules/@peerbit/indexer-sqlite3/dist/src/schema.js b/node_modules/@peerbit/indexer-sqlite3/dist/src/schema.js
index e671e35..9f2c4bb 100644
--- a/node_modules/@peerbit/indexer-sqlite3/dist/src/schema.js
+++ b/node_modules/@peerbit/indexer-sqlite3/dist/src/schema.js
@@ -134,7 +134,7 @@ const sqlType = (type, isOptional = false) => {
 };
 export const getSQLTable = (ctor, path, primary, inline, addJoinField, fromOptionalField = false) => {
     let clazzes = getDependencies(ctor, 0);
-    if (!clazzes) {
+    if (!clazzes || clazzes.length === 0) {
         clazzes = [ctor];
     }
     let ret = [];
@@ -445,6 +445,12 @@ const unwrapNestedType = (type) => {
     if (type instanceof WrappedType) {
         return type.elementType;
     }
+    if (type instanceof OptionKind) {
+        return unwrapNestedType(type.elementType);
+    }
+    if (type instanceof VecKind) {
+        return unwrapNestedType(type.elementType);
+    }
     return type;
 };
@@ -490,12 +496,15 @@ const getTableFromValue = (parentTable, tables, field, value) => {
     }
     else {
-        const testCtors = value?.constructor
-            ? [value?.constructor]
-            : [
-                unwrapNestedType(field.type),
-                ...(getDependencies(unwrapNestedType(field.type), 0) || []),
-            ];
+        const nestedType = unwrapNestedType(field.type);
+        const testCtors = value?.constructor
+            ? [
+                value.constructor,
+                nestedType,
+                ...(getDependencies(nestedType, 0) || []),
+            ]
+            : [nestedType, ...(getDependencies(nestedType, 0) || [])];
         for (const ctor of testCtors) {
             if (!ctor) {
                 continue;
             }
diff --git a/node_modules/@peerbit/indexer-sqlite3/src/schema.ts b/node_modules/@peerbit/indexer-sqlite3/src/schema.ts
index 9ccba23..3a2b4c1 100644
--- a/node_modules/@peerbit/indexer-sqlite3/src/schema.ts
+++ b/node_modules/@peerbit/indexer-sqlite3/src/schema.ts
@@ -192,7 +192,7 @@ export const getSQLTable = (
 
 	/* name: string */
 ): Table[] => {
 	let clazzes = getDependencies(ctor, 0) as any as Constructor<any>[];
-	if (!clazzes) {
+	if (!clazzes || clazzes.length === 0) {
 		clazzes = [ctor as Constructor<any>];
 	}
 
@@ -597,6 +597,12 @@ const unwrapNestedType = (type: FieldType): FieldType => {
 	if (type instanceof WrappedType) {
 		return type.elementType;
 	}
+	if (type instanceof OptionKind) {
+		return unwrapNestedType(type.elementType);
+	}
+	if (type instanceof VecKind) {
+		return unwrapNestedType(type.elementType);
+	}
 	return type;
 };
@@ -664,12 +670,15 @@ const getTableFromValue = (
 	if (!isNestedType(field.type)) {
 		clazzName = WRAPPED_SIMPLE_VALUE_VARIANT;
 	} else {
-		const testCtors = value?.constructor
-			? [value?.constructor]
-			: ([
-					unwrapNestedType(field.type),
-					...(getDependencies(unwrapNestedType(field.type) as any, 0) || []),
-				] as Constructor<any>[]);
+		const nestedType = unwrapNestedType(field.type);
+		const testCtors = value?.constructor
+			? ([
+					value.constructor,
+					nestedType,
+					...(getDependencies(nestedType as any, 0) || []),
+				] as Constructor<any>[])
+			: ([nestedType, ...(getDependencies(nestedType as any, 0) || [])] as Constructor<any>[]);
 		for (const ctor of testCtors) {
 			if (!ctor) {
 				continue;
 			}
